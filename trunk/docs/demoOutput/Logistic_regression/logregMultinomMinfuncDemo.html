
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>Minfunc Logreg Demo</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2010-04-29"><meta name="m-file" content="logregMultinomMinfuncDemo"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>Minfunc Logreg Demo</h1><pre class="codeinput"><span class="comment">%PMTKauthor Mark Schmidt</span>
<span class="comment">%PMTKurl  http://people.cs.ubc.ca/~schmidtm/Software/minFunc/minFunc.html</span>

options.Display = <span class="string">'none'</span>;
setSeed(1);
nClasses = 5;
nInstances = 1000;
<span class="comment">%nInstances = 100;</span>
nVars = 2;
[X,y] = makeData(<span class="string">'multinomial'</span>,nInstances,nVars,nClasses);

<span class="comment">% Add bias</span>
X0 = X;
X = [ones(nInstances,1) X];


funObj = @(W)SoftmaxLoss2(W,X,y,nClasses);
lambda0 = 1e-4;
lambda = lambda0*ones(nVars+1,nClasses-1);
lambda(1,:) = 0; <span class="comment">% Don't penalize biases</span>
fprintf(<span class="string">'Training multinomial logistic regression model...\n'</span>);
wSoftmax = minFunc(@penalizedL2,zeros((nVars+1)*(nClasses-1),1),options,funObj,lambda(:));
wSoftmax = reshape(wSoftmax,[nVars+1 nClasses-1]);
wSoftmax = [wSoftmax zeros(nVars+1,1)];

opts.maxIter = 2000;
opts.TolX   = 1e-7;
opts.TolFun = 1e-7;
model = logregFit(X0, y, <span class="string">'lambda'</span>, lambda0, <span class="string">'standardizeX'</span>, false, <span class="string">'fitOptions'</span>, opts);
wMAP = model.w;
assert(approxeq(wMAP, wSoftmax))

[junk yhat] = max(X*wSoftmax,[],2);
trainErr = sum(yhat~=y)/length(y)

[yhat2, prob] = logregPredict(model, X0);
assert(isequal(yhat, yhat2))

figure;
plotClassifier(X,y,wSoftmax,<span class="string">'Multinomial Logistic Regression'</span>);
</pre><pre class="codeoutput">Training multinomial logistic regression model...
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          3    7.02183e-003    9.52623e+002    6.35052e+002
         2          4    1.00000e+000    6.26545e+002    2.98376e+002
         3          5    1.00000e+000    4.87923e+002    2.75662e+002
         4          6    1.00000e+000    4.13277e+002    1.11728e+002
         5          7    1.00000e+000    3.65721e+002    7.34159e+001
         6          8    1.00000e+000    3.29580e+002    1.00610e+002
         7          9    1.00000e+000    2.78570e+002    5.87822e+001
         8         10    1.00000e+000    2.42451e+002    5.58570e+001
         9         12    5.51275e-001    1.74692e+002    4.97782e+001
        10         13    1.00000e+000    1.48107e+002    2.60018e+001
        11         14    1.00000e+000    1.08850e+002    1.58140e+001
        12         15    1.00000e+000    8.48440e+001    2.01630e+001
        13         16    1.00000e+000    6.54487e+001    1.51321e+001
        14         17    1.00000e+000    5.31180e+001    1.19278e+001
        15         18    1.00000e+000    4.34340e+001    1.04286e+001
        16         19    1.00000e+000    3.72058e+001    4.77741e+000
        17         20    1.00000e+000    3.39754e+001    2.94367e+000
        18         21    1.00000e+000    3.21080e+001    3.41155e+000
        19         22    1.00000e+000    3.10335e+001    3.24108e+000
        20         23    1.00000e+000    3.02621e+001    2.10655e+000
        21         24    1.00000e+000    2.99177e+001    1.29374e+000
        22         25    1.00000e+000    2.98276e+001    8.60236e-001
        23         26    1.00000e+000    2.97874e+001    5.56377e-001
        24         27    1.00000e+000    2.97761e+001    4.96482e-001
        25         28    1.00000e+000    2.97650e+001    4.56991e-001
        26         29    1.00000e+000    2.97568e+001    4.41858e-001
        27         30    1.00000e+000    2.97487e+001    3.57127e-001
        28         31    1.00000e+000    2.97443e+001    3.01549e-001
        29         32    1.00000e+000    2.97410e+001    4.26088e-001
        30         33    1.00000e+000    2.97376e+001    6.34306e-001
        31         34    1.00000e+000    2.97312e+001    8.91071e-001
        32         35    1.00000e+000    2.97201e+001    1.16006e+000
        33         36    1.00000e+000    2.97016e+001    1.36526e+000
        34         37    1.00000e+000    2.96735e+001    1.44378e+000
        35         38    1.00000e+000    2.96292e+001    1.42116e+000
        36         39    1.00000e+000    2.95752e+001    1.50129e+000
        37         40    1.00000e+000    2.95201e+001    1.52927e+000
        38         41    1.00000e+000    2.94603e+001    1.67146e+000
        39         42    1.00000e+000    2.94094e+001    1.45708e+000
        40         43    1.00000e+000    2.93844e+001    1.10940e+000
        41         44    1.00000e+000    2.93746e+001    9.87188e-001
        42         45    1.00000e+000    2.93674e+001    8.42938e-001
        43         46    1.00000e+000    2.93608e+001    8.08474e-001
        44         47    1.00000e+000    2.93553e+001    9.36389e-001
        45         48    1.00000e+000    2.93515e+001    1.06871e+000
        46         49    1.00000e+000    2.93489e+001    1.08391e+000
        47         50    1.00000e+000    2.93456e+001    9.68426e-001
        48         51    1.00000e+000    2.93405e+001    6.93572e-001
        49         52    1.00000e+000    2.93360e+001    3.39953e-001
        50         53    1.00000e+000    2.93329e+001    2.03164e-001
        51         54    1.00000e+000    2.93316e+001    2.64232e-001
        52         55    1.00000e+000    2.93309e+001    2.09607e-001
        53         56    1.00000e+000    2.93306e+001    1.55904e-001
        54         57    1.00000e+000    2.93305e+001    1.24386e-001
        55         58    1.00000e+000    2.93303e+001    1.11028e-001
        56         59    1.00000e+000    2.93300e+001    1.04294e-001
        57         60    1.00000e+000    2.93292e+001    1.37518e-001
        58         61    1.00000e+000    2.93275e+001    2.19411e-001
        59         62    1.00000e+000    2.93242e+001    3.74208e-001
        60         63    1.00000e+000    2.93174e+001    5.30140e-001
        61         64    1.00000e+000    2.93044e+001    6.21557e-001
        62         65    1.00000e+000    2.92882e+001    5.61887e-001
        63         66    1.00000e+000    2.92815e+001    1.73620e-001
        64         67    1.00000e+000    2.92798e+001    5.79105e-002
        65         68    1.00000e+000    2.92795e+001    7.02638e-003
        66         69    1.00000e+000    2.92795e+001    3.07036e-003
        67         70    1.00000e+000    2.92795e+001    3.36369e-004
Directional Derivative below TolX
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          3    8.88919e-003    7.62616e+002    5.01662e+002
         2          4    1.00000e+000    5.04779e+002    2.48230e+002
         3          5    1.00000e+000    3.90336e+002    2.12041e+002
         4          6    1.00000e+000    3.33115e+002    9.15147e+001
         5          7    1.00000e+000    2.94455e+002    5.77899e+001
         6          8    1.00000e+000    2.66402e+002    9.11625e+001
         7          9    1.00000e+000    2.28937e+002    4.71516e+001
         8         10    1.00000e+000    1.98578e+002    4.55753e+001
         9         11    1.00000e+000    1.37107e+002    3.20687e+001
        10         12    1.00000e+000    1.14563e+002    3.17213e+001
        11         13    1.00000e+000    7.78022e+001    1.11408e+001
        12         14    1.00000e+000    6.48612e+001    1.30766e+001
        13         15    1.00000e+000    5.01248e+001    1.83372e+001
        14         16    1.00000e+000    3.89536e+001    4.96911e+000
        15         17    1.00000e+000    3.51715e+001    4.61711e+000
        16         18    1.00000e+000    3.08546e+001    5.63508e+000
        17         19    1.00000e+000    2.92743e+001    4.05149e+000
        18         20    1.00000e+000    2.81940e+001    3.26050e+000
        19         21    1.00000e+000    2.73771e+001    2.42962e+000
        20         22    1.00000e+000    2.66556e+001    1.67777e+000
        21         23    1.00000e+000    2.64039e+001    1.86012e+000
        22         24    1.00000e+000    2.63169e+001    1.69099e+000
        23         25    1.00000e+000    2.62787e+001    1.25411e+000
        24         26    1.00000e+000    2.62650e+001    8.56986e-001
        25         27    1.00000e+000    2.62529e+001    4.85809e-001
        26         28    1.00000e+000    2.62413e+001    4.29803e-001
        27         29    1.00000e+000    2.62344e+001    5.54398e-001
        28         30    1.00000e+000    2.62314e+001    5.80244e-001
        29         31    1.00000e+000    2.62288e+001    5.31664e-001
        30         32    1.00000e+000    2.62256e+001    4.37524e-001
        31         33    1.00000e+000    2.62229e+001    3.95688e-001
        32         34    1.00000e+000    2.62188e+001    3.62471e-001
        33         35    1.00000e+000    2.62138e+001    4.16364e-001
        34         36    1.00000e+000    2.62080e+001    5.55807e-001
        35         37    1.00000e+000    2.62025e+001    6.77226e-001
        36         38    1.00000e+000    2.61951e+001    7.29052e-001
        37         39    1.00000e+000    2.61782e+001    7.31203e-001
        38         40    1.00000e+000    2.61403e+001    8.36682e-001
        39         41    1.00000e+000    2.60908e+001    9.65918e-001
        40         42    1.00000e+000    2.60596e+001    8.91822e-001
        41         43    1.00000e+000    2.60501e+001    8.32822e-001
        42         44    1.00000e+000    2.60468e+001    8.16007e-001
        43         45    1.00000e+000    2.60432e+001    7.57830e-001
        44         46    1.00000e+000    2.60365e+001    6.05736e-001
        45         47    1.00000e+000    2.60276e+001    3.62522e-001
        46         48    1.00000e+000    2.60192e+001    2.16903e-001
        47         49    1.00000e+000    2.60151e+001    2.08385e-001
        48         50    1.00000e+000    2.60136e+001    1.48875e-001
        49         51    1.00000e+000    2.60127e+001    1.13901e-001
        50         52    1.00000e+000    2.60123e+001    9.35418e-002
        51         53    1.00000e+000    2.60121e+001    7.87129e-002
        52         54    1.00000e+000    2.60119e+001    8.49060e-002
        53         55    1.00000e+000    2.60116e+001    1.21371e-001
        54         56    1.00000e+000    2.60109e+001    1.91146e-001
        55         57    1.00000e+000    2.60093e+001    2.96519e-001
        56         58    1.00000e+000    2.60058e+001    4.23144e-001
        57         59    1.00000e+000    2.60000e+001    4.93338e-001
        58         60    1.00000e+000    2.59939e+001    3.76692e-001
        59         61    1.00000e+000    2.59910e+001    1.42793e-001
        60         62    1.00000e+000    2.59905e+001    2.40189e-002
        61         63    1.00000e+000    2.59905e+001    3.87731e-003
        62         64    1.00000e+000    2.59905e+001    1.28414e-003
        63         65    1.00000e+000    2.59905e+001    5.50399e-004
Directional Derivative below TolX
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          3    9.18359e-003    7.52666e+002    4.94968e+002
         2          4    1.00000e+000    4.91495e+002    2.37272e+002
         3          5    1.00000e+000    3.98359e+002    2.58156e+002
         4          6    1.00000e+000    3.38056e+002    9.99635e+001
         5          7    1.00000e+000    3.00837e+002    5.93729e+001
         6          8    1.00000e+000    2.72977e+002    5.69194e+001
         7         10    4.40551e-001    2.54718e+002    1.18264e+002
         8         11    1.00000e+000    2.18792e+002    6.98949e+001
         9         12    1.00000e+000    1.71843e+002    4.58631e+001
        10         13    1.00000e+000    1.36248e+002    5.12009e+001
        11         14    1.00000e+000    1.20084e+002    2.40074e+001
        12         15    1.00000e+000    9.33192e+001    1.74394e+001
        13         16    1.00000e+000    7.74782e+001    2.00384e+001
        14         17    1.00000e+000    6.19518e+001    1.62268e+001
        15         18    1.00000e+000    5.15119e+001    3.52539e+001
        16         19    1.00000e+000    3.97221e+001    1.28425e+001
        17         20    1.00000e+000    3.59882e+001    8.66593e+000
        18         21    1.00000e+000    3.39090e+001    9.69938e+000
        19         22    1.00000e+000    3.18566e+001    8.06387e+000
        20         23    1.00000e+000    2.98172e+001    5.63510e+000
        21         24    1.00000e+000    2.87238e+001    4.51709e+000
        22         25    1.00000e+000    2.81413e+001    5.17343e+000
        23         26    1.00000e+000    2.78246e+001    4.60456e+000
        24         27    1.00000e+000    2.76155e+001    3.29348e+000
        25         28    1.00000e+000    2.74622e+001    1.96004e+000
        26         29    1.00000e+000    2.73829e+001    1.78455e+000
        27         30    1.00000e+000    2.73445e+001    1.55929e+000
        28         31    1.00000e+000    2.73107e+001    1.02701e+000
        29         32    1.00000e+000    2.72875e+001    6.83393e-001
        30         33    1.00000e+000    2.72721e+001    6.33771e-001
        31         34    1.00000e+000    2.72524e+001    7.97829e-001
        32         35    1.00000e+000    2.72275e+001    7.68328e-001
        33         36    1.00000e+000    2.72074e+001    4.73338e-001
        34         37    1.00000e+000    2.72006e+001    5.56615e-001
        35         38    1.00000e+000    2.71982e+001    6.75745e-001
        36         39    1.00000e+000    2.71956e+001    7.35557e-001
        37         40    1.00000e+000    2.71920e+001    7.38165e-001
        38         41    1.00000e+000    2.71874e+001    6.35415e-001
        39         42    1.00000e+000    2.71819e+001    4.48244e-001
        40         43    1.00000e+000    2.71761e+001    4.48877e-001
        41         44    1.00000e+000    2.71690e+001    8.22896e-001
        42         45    1.00000e+000    2.71596e+001    1.34055e+000
        43         46    1.00000e+000    2.71489e+001    1.69765e+000
        44         47    1.00000e+000    2.71392e+001    1.81367e+000
        45         48    1.00000e+000    2.71285e+001    1.69312e+000
        46         49    1.00000e+000    2.71109e+001    1.42509e+000
        47         50    1.00000e+000    2.70838e+001    1.21813e+000
        48         51    1.00000e+000    2.70455e+001    9.53399e-001
        49         52    1.00000e+000    2.70084e+001    8.53067e-001
        50         53    1.00000e+000    2.69873e+001    8.26037e-001
        51         54    1.00000e+000    2.69768e+001    9.71172e-001
        52         55    1.00000e+000    2.69680e+001    1.08134e+000
        53         56    1.00000e+000    2.69530e+001    1.17930e+000
        54         57    1.00000e+000    2.69236e+001    1.25400e+000
        55         58    1.00000e+000    2.68807e+001    1.04320e+000
        56         59    1.00000e+000    2.68448e+001    5.28337e-001
        57         60    1.00000e+000    2.68310e+001    1.33145e-001
        58         61    1.00000e+000    2.68297e+001    9.38471e-002
        59         62    1.00000e+000    2.68296e+001    7.69457e-002
        60         63    1.00000e+000    2.68294e+001    5.16941e-002
        61         64    1.00000e+000    2.68290e+001    5.08989e-002
        62         65    1.00000e+000    2.68284e+001    1.22605e-001
        63         66    1.00000e+000    2.68266e+001    2.57392e-001
        64         67    1.00000e+000    2.68227e+001    4.40754e-001
        65         68    1.00000e+000    2.68151e+001    6.13431e-001
        66         69    1.00000e+000    2.68051e+001    5.98356e-001
        67         71    3.66057e-001    2.68029e+001    4.19187e-001
        68         72    1.00000e+000    2.67981e+001    2.13074e-001
        69         73    1.00000e+000    2.67969e+001    3.62554e-002
        70         74    1.00000e+000    2.67968e+001    8.53433e-003
        71         75    1.00000e+000    2.67968e+001    1.95388e-003
Directional Derivative below TolX
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2    1.19070e-003    1.17602e+003    7.44917e+002
         2          3    1.00000e+000    5.02111e+002    2.18888e+002
         3          4    1.00000e+000    3.99380e+002    1.35079e+002
         4          5    1.00000e+000    3.38812e+002    1.34739e+002
         5          6    1.00000e+000    2.85149e+002    1.40780e+002
         6          7    1.00000e+000    2.59478e+002    6.45058e+001
         7          8    1.00000e+000    2.40432e+002    4.45364e+001
         8          9    1.00000e+000    2.24571e+002    5.00472e+001
         9         10    1.00000e+000    1.85928e+002    5.30918e+001
        10         12    2.11742e-001    1.56719e+002    8.36583e+001
        11         14    5.77420e-001    1.27724e+002    7.67377e+001
        12         15    1.00000e+000    1.09163e+002    2.29683e+001
        13         16    1.00000e+000    9.58414e+001    2.33966e+001
        14         17    1.00000e+000    7.99237e+001    2.85091e+001
        15         18    1.00000e+000    6.55745e+001    2.84459e+001
        16         19    1.00000e+000    5.19731e+001    2.36945e+001
        17         20    1.00000e+000    3.99766e+001    1.69929e+001
        18         21    1.00000e+000    3.18772e+001    1.38106e+001
        19         22    1.00000e+000    2.80489e+001    8.12794e+000
        20         23    1.00000e+000    2.64708e+001    6.69047e+000
        21         24    1.00000e+000    2.54537e+001    4.60013e+000
        22         25    1.00000e+000    2.47670e+001    2.63491e+000
        23         26    1.00000e+000    2.44239e+001    1.53274e+000
        24         27    1.00000e+000    2.42760e+001    1.79256e+000
        25         28    1.00000e+000    2.41920e+001    1.81618e+000
        26         29    1.00000e+000    2.40910e+001    1.45025e+000
        27         30    1.00000e+000    2.40023e+001    7.42902e-001
        28         31    1.00000e+000    2.39679e+001    5.57290e-001
        29         32    1.00000e+000    2.39560e+001    5.65865e-001
        30         33    1.00000e+000    2.39485e+001    4.68985e-001
        31         34    1.00000e+000    2.39408e+001    4.36946e-001
        32         35    1.00000e+000    2.39348e+001    3.82278e-001
        33         36    1.00000e+000    2.39293e+001    3.81345e-001
        34         37    1.00000e+000    2.39240e+001    5.09207e-001
        35         38    1.00000e+000    2.39175e+001    6.46192e-001
        36         39    1.00000e+000    2.39069e+001    7.73221e-001
        37         40    1.00000e+000    2.38868e+001    9.48089e-001
        38         41    1.00000e+000    2.38482e+001    1.13443e+000
        39         42    1.00000e+000    2.37819e+001    1.38676e+000
        40         43    1.00000e+000    2.36973e+001    1.61660e+000
        41         44    1.00000e+000    2.36309e+001    1.40703e+000
        42         45    1.00000e+000    2.35982e+001    1.19640e+000
        43         46    1.00000e+000    2.35823e+001    1.20810e+000
        44         47    1.00000e+000    2.35741e+001    1.15755e+000
        45         48    1.00000e+000    2.35700e+001    1.01805e+000
        46         49    1.00000e+000    2.35675e+001    8.66714e-001
        47         50    1.00000e+000    2.35647e+001    7.35074e-001
        48         51    1.00000e+000    2.35594e+001    5.75568e-001
        49         52    1.00000e+000    2.35510e+001    3.88614e-001
        50         53    1.00000e+000    2.35403e+001    6.71807e-001
        51         54    1.00000e+000    2.35310e+001    9.00591e-001
        52         55    1.00000e+000    2.35241e+001    8.40061e-001
        53         56    1.00000e+000    2.35156e+001    5.38042e-001
        54         57    1.00000e+000    2.35084e+001    1.87461e-001
        55         58    1.00000e+000    2.35057e+001    2.19773e-001
        56         59    1.00000e+000    2.35041e+001    1.88061e-001
        57         60    1.00000e+000    2.35027e+001    5.64633e-002
        58         61    1.00000e+000    2.35026e+001    3.63270e-002
        59         62    1.00000e+000    2.35025e+001    6.62245e-002
        60         63    1.00000e+000    2.35024e+001    9.17308e-002
        61         64    1.00000e+000    2.35022e+001    1.51883e-001
        62         65    1.00000e+000    2.35018e+001    2.24129e-001
        63         66    1.00000e+000    2.35007e+001    3.30882e-001
        64         67    1.00000e+000    2.34981e+001    4.63562e-001
        65         68    1.00000e+000    2.34926e+001    6.14549e-001
        66         69    1.00000e+000    2.34831e+001    6.83906e-001
        67         70    1.00000e+000    2.34739e+001    6.14164e-001
        68         71    1.00000e+000    2.34692e+001    1.92107e-001
        69         72    1.00000e+000    2.34683e+001    3.62932e-002
        70         73    1.00000e+000    2.34683e+001    3.96859e-003
        71         74    1.00000e+000    2.34683e+001    9.24376e-004
Directional Derivative below TolX
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2    1.20007e-003    1.17392e+003    7.45608e+002
         2          3    1.00000e+000    5.02817e+002    2.03093e+002
         3          4    1.00000e+000    4.09783e+002    1.46798e+002
         4          5    1.00000e+000    3.51070e+002    1.38657e+002
         5          6    1.00000e+000    3.01556e+002    8.44823e+001
         6          7    1.00000e+000    2.72528e+002    5.66390e+001
         7          8    1.00000e+000    2.39958e+002    9.88275e+001
         8          9    1.00000e+000    1.91162e+002    4.72758e+001
         9         10    1.00000e+000    1.51973e+002    4.83882e+001
        10         11    1.00000e+000    1.25629e+002    4.68623e+001
        11         12    1.00000e+000    1.05143e+002    2.51002e+001
        12         13    1.00000e+000    7.85426e+001    2.07583e+001
        13         14    1.00000e+000    6.68879e+001    2.73602e+001
        14         15    1.00000e+000    5.48354e+001    2.30385e+001
        15         16    1.00000e+000    4.45094e+001    2.66465e+001
        16         17    1.00000e+000    3.87150e+001    1.83340e+001
        17         18    1.00000e+000    3.33423e+001    1.01711e+001
        18         19    1.00000e+000    3.12708e+001    7.84100e+000
        19         20    1.00000e+000    2.93589e+001    6.42678e+000
        20         21    1.00000e+000    2.69962e+001    4.87574e+000
        21         22    1.00000e+000    2.58440e+001    2.03080e+000
        22         23    1.00000e+000    2.56687e+001    1.47467e+000
        23         24    1.00000e+000    2.54322e+001    9.49631e-001
        24         25    1.00000e+000    2.54024e+001    9.74470e-001
        25         26    1.00000e+000    2.52845e+001    1.07132e+000
        26         27    1.00000e+000    2.52615e+001    9.25271e-001
        27         28    1.00000e+000    2.52415e+001    6.38384e-001
        28         29    1.00000e+000    2.52354e+001    6.16965e-001
        29         30    1.00000e+000    2.52296e+001    4.60856e-001
        30         31    1.00000e+000    2.52252e+001    4.49383e-001
        31         32    1.00000e+000    2.52194e+001    5.72451e-001
        32         33    1.00000e+000    2.52133e+001    8.42842e-001
        33         34    1.00000e+000    2.52063e+001    1.13932e+000
        34         35    1.00000e+000    2.51990e+001    1.26952e+000
        35         36    1.00000e+000    2.51879e+001    1.20725e+000
        36         37    1.00000e+000    2.51638e+001    9.64654e-001
        37         38    1.00000e+000    2.51169e+001    1.05626e+000
        38         39    1.00000e+000    2.50285e+001    1.63105e+000
        39         40    1.00000e+000    2.48888e+001    2.16903e+000
        40         41    1.00000e+000    2.47384e+001    1.86437e+000
        41         42    1.00000e+000    2.46410e+001    9.66612e-001
        42         43    1.00000e+000    2.46173e+001    2.45844e-001
        43         44    1.00000e+000    2.46145e+001    2.00164e-001
        44         45    1.00000e+000    2.46134e+001    2.31306e-001
        45         46    1.00000e+000    2.46125e+001    1.98323e-001
        46         47    1.00000e+000    2.46116e+001    1.58508e-001
        47         48    1.00000e+000    2.46106e+001    1.36287e-001
        48         49    1.00000e+000    2.46094e+001    1.77551e-001
        49         50    1.00000e+000    2.46084e+001    2.34282e-001
        50         51    1.00000e+000    2.46077e+001    2.34240e-001
        51         52    1.00000e+000    2.46069e+001    2.23584e-001
        52         53    1.00000e+000    2.46058e+001    2.38025e-001
        53         54    1.00000e+000    2.46040e+001    2.61385e-001
        54         55    1.00000e+000    2.46012e+001    3.28604e-001
        55         56    1.00000e+000    2.45977e+001    3.76893e-001
        56         57    1.00000e+000    2.45928e+001    3.93926e-001
        57         58    1.00000e+000    2.45822e+001    4.27516e-001
        58         59    1.00000e+000    2.45577e+001    4.58475e-001
        59         60    1.00000e+000    2.45285e+001    4.06634e-001
        60         61    1.00000e+000    2.45188e+001    3.85158e-001
        61         62    1.00000e+000    2.45136e+001    1.24001e-001
        62         63    1.00000e+000    2.45127e+001    2.57206e-002
        63         64    1.00000e+000    2.45127e+001    7.95729e-003
        64         65    1.00000e+000    2.45127e+001    2.37460e-003
        65         66    1.00000e+000    2.45127e+001    1.00894e-003
Function Value changing by less than TolX
 Iteration   FunEvals     Step Length    Function Val        Opt Cond
         1          2    1.18468e-003    1.17124e+003    7.49507e+002
         2          3    1.00000e+000    4.90537e+002    2.22440e+002
         3          4    1.00000e+000    3.86370e+002    1.29340e+002
         4          5    1.00000e+000    3.24963e+002    1.33647e+002
         5          6    1.00000e+000    2.73659e+002    1.60934e+002
         6          7    1.00000e+000    2.47710e+002    6.73797e+001
         7          8    1.00000e+000    2.29802e+002    4.11954e+001
         8          9    1.00000e+000    2.16790e+002    4.72261e+001
         9         10    1.00000e+000    1.88369e+002    5.33106e+001
        10         12    6.02289e-001    1.24946e+002    3.33877e+001
        11         13    1.00000e+000    1.06720e+002    5.16066e+001
        12         14    1.00000e+000    8.56871e+001    4.65216e+001
        13         15    1.00000e+000    7.18219e+001    3.04578e+001
        14         16    1.00000e+000    5.75441e+001    1.82175e+001
        15         17    1.00000e+000    4.91310e+001    1.73440e+001
        16         18    1.00000e+000    4.16691e+001    1.62280e+001
        17         19    1.00000e+000    3.58052e+001    1.49475e+001
        18         20    1.00000e+000    2.89844e+001    8.66511e+000
        19         21    1.00000e+000    2.40332e+001    2.73413e+000
        20         22    1.00000e+000    2.32668e+001    1.65323e+000
        21         23    1.00000e+000    2.29650e+001    1.27932e+000
        22         24    1.00000e+000    2.28777e+001    1.68030e+000
        23         25    1.00000e+000    2.28550e+001    1.77803e+000
        24         26    1.00000e+000    2.28189e+001    1.84463e+000
        25         27    1.00000e+000    2.27901e+001    1.59360e+000
        26         28    1.00000e+000    2.27558e+001    1.01279e+000
        27         29    1.00000e+000    2.27279e+001    6.02483e-001
        28         30    1.00000e+000    2.27136e+001    8.22058e-001
        29         31    1.00000e+000    2.27041e+001    1.06717e+000
        30         32    1.00000e+000    2.26906e+001    1.31000e+000
        31         33    1.00000e+000    2.26767e+001    1.41129e+000
        32         34    1.00000e+000    2.26608e+001    1.36773e+000
        33         35    1.00000e+000    2.26367e+001    1.32380e+000
        34         36    1.00000e+000    2.25938e+001    1.33947e+000
        35         37    1.00000e+000    2.25335e+001    1.47320e+000
        36         38    1.00000e+000    2.24686e+001    1.57268e+000
        37         39    1.00000e+000    2.23881e+001    1.55507e+000
        38         40    1.00000e+000    2.22753e+001    1.44198e+000
        39         41    1.00000e+000    2.22197e+001    1.30873e+000
        40         42    1.00000e+000    2.21949e+001    1.33289e+000
        41         43    1.00000e+000    2.21796e+001    1.24648e+000
        42         44    1.00000e+000    2.21667e+001    1.04485e+000
        43         45    1.00000e+000    2.21555e+001    8.78569e-001
        44         46    1.00000e+000    2.21488e+001    7.59025e-001
        45         47    1.00000e+000    2.21428e+001    5.11962e-001
        46         48    1.00000e+000    2.21391e+001    2.39093e-001
        47         49    1.00000e+000    2.21377e+001    7.42700e-002
        48         50    1.00000e+000    2.21373e+001    4.94850e-002
        49         51    1.00000e+000    2.21372e+001    4.47142e-002
        50         52    1.00000e+000    2.21367e+001    4.80709e-002
        51         53    1.00000e+000    2.21358e+001    1.19824e-001
        52         54    1.00000e+000    2.21347e+001    1.76170e-001
        53         55    1.00000e+000    2.21321e+001    2.61144e-001
        54         56    1.00000e+000    2.21271e+001    3.33331e-001
        55         57    1.00000e+000    2.21191e+001    4.40308e-001
        56         58    1.00000e+000    2.21109e+001    5.29170e-001
        57         59    1.00000e+000    2.21054e+001    5.92930e-001
        58         60    1.00000e+000    2.21020e+001    5.34273e-001
        59         61    1.00000e+000    2.20995e+001    3.41914e-001
        60         62    1.00000e+000    2.20982e+001    1.14993e-001
        61         63    1.00000e+000    2.20979e+001    2.35113e-002
        62         64    1.00000e+000    2.20978e+001    8.30601e-003
        63         65    1.00000e+000    2.20978e+001    1.88747e-003
        64         66    1.00000e+000    2.20978e+001    2.56682e-004
Directional Derivative below TolX
trainErr =
    0.0030
</pre><img vspace="5" hspace="5" src="logregMultinomMinfuncDemo_01.png" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
%% Minfunc Logreg Demo
%PMTKauthor Mark Schmidt
%PMTKurl  http://people.cs.ubc.ca/~schmidtm/Software/minFunc/minFunc.html

options.Display = 'none';
setSeed(1); 
nClasses = 5;
nInstances = 1000;
%nInstances = 100;
nVars = 2;
[X,y] = makeData('multinomial',nInstances,nVars,nClasses);

% Add bias
X0 = X;
X = [ones(nInstances,1) X];


funObj = @(W)SoftmaxLoss2(W,X,y,nClasses);
lambda0 = 1e-4;
lambda = lambda0*ones(nVars+1,nClasses-1);
lambda(1,:) = 0; % Don't penalize biases
fprintf('Training multinomial logistic regression model...\n');
wSoftmax = minFunc(@penalizedL2,zeros((nVars+1)*(nClasses-1),1),options,funObj,lambda(:));
wSoftmax = reshape(wSoftmax,[nVars+1 nClasses-1]);
wSoftmax = [wSoftmax zeros(nVars+1,1)];

opts.maxIter = 2000;
opts.TolX   = 1e-7;
opts.TolFun = 1e-7;
model = logregFit(X0, y, 'lambda', lambda0, 'standardizeX', false, 'fitOptions', opts);
wMAP = model.w; 
assert(approxeq(wMAP, wSoftmax))

[junk yhat] = max(X*wSoftmax,[],2);
trainErr = sum(yhat~=y)/length(y)

[yhat2, prob] = logregPredict(model, X0);
assert(isequal(yhat, yhat2))

figure;
plotClassifier(X,y,wSoftmax,'Multinomial Logistic Regression');

##### SOURCE END #####
--></body></html>